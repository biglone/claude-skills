---
name: requirements-doc
description: 需求文档生成器。将简单的需求描述转换为结构化的需求文档、功能划分和任务列表。当用户要求"生成需求文档"、"分析需求"、"需求拆解"时使用。
allowed-tools: Read, Write, Grep, Glob
related-skills: task-planner, api-designer, autonomous-dev, brainstormer
---

# 需求文档生成器

将简单的需求描述转换为详细的、结构化的需求文档和任务列表。

## 核心功能

```
简单需求描述
    ↓
需求分析和扩展
    ↓
输出结构化文档
    ├─ REQUIREMENTS.md（需求文档）
    └─ TASK_LIST.md（任务清单）
```

## 需求文档结构

### REQUIREMENTS.md 包含：

```markdown
# [功能名称] 需求文档

## 1. 功能概述
[一句话总结这个功能是什么]

## 2. 背景和目标
**背景**：为什么需要这个功能
**目标**：期望达到什么效果

## 3. 用户故事
- 作为 [角色]，我希望 [功能]，以便 [价值]
- 作为 [角色]，我希望 [功能]，以便 [价值]

## 4. 功能详细描述
[详细描述功能的行为和特性]

## 5. 验收标准
- [ ] Given [前置条件]，When [操作]，Then [预期结果]
- [ ] Given [前置条件]，When [操作]，Then [预期结果]

## 6. 功能模块划分

### 6.1 前端模块
- [模块名称]：[功能描述]

### 6.2 后端模块
- [模块名称]：[功能描述]

### 6.3 数据库模块
- [模块名称]：[功能描述]

## 7. 技术方案

### 7.1 技术栈
- 前端：[技术选型]
- 后端：[技术选型]
- 数据库：[技术选型]

### 7.2 关键技术点
- [技术点1]：[说明]
- [技术点2]：[说明]

### 7.3 架构设计
[简要架构说明或图示]

## 8. 接口设计（如适用）
- `[方法] [路径]`：[功能描述]

## 9. 数据模型（如适用）
```

### 9.1 [模型名称]
| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
```

## 10. 风险和注意事项
- ⚠️  [风险点1]
- ⚠️  [风险点2]

## 11. 非功能需求
- 性能要求：[说明]
- 安全要求：[说明]
- 兼容性要求：[说明]

---
生成时间：[时间戳]
```

### TASK_LIST.md 包含：

```markdown
# [功能名称] 任务清单

## 任务分解

### 阶段 1：准备工作
| 任务ID | 任务描述 | 预估时间 | 优先级 | 依赖 | 状态 |
|--------|----------|----------|--------|------|------|
| T1.1 | [任务] | [时间] | P0/P1/P2 | - | ⬜ |

### 阶段 2：开发实现
| 任务ID | 任务描述 | 预估时间 | 优先级 | 依赖 | 状态 |
|--------|----------|----------|--------|------|------|
| T2.1 | [任务] | [时间] | P0 | T1.1 | ⬜ |

### 阶段 3：测试验证
| 任务ID | 任务描述 | 预估时间 | 优先级 | 依赖 | 状态 |
|--------|----------|----------|--------|------|------|
| T3.1 | [任务] | [时间] | P0 | T2.x | ⬜ |

### 阶段 4：发布上线
| 任务ID | 任务描述 | 预估时间 | 优先级 | 依赖 | 状态 |
|--------|----------|----------|--------|------|------|
| T4.1 | [任务] | [时间] | P0 | T3.x | ⬜ |

## 任务依赖关系图
```
[准备] → [开发] → [测试] → [发布]
  T1.x    T2.x     T3.x     T4.x
```

## 优先级说明
- P0：必须完成（核心功能）
- P1：重要（增强功能）
- P2：可选（优化项）

## 状态标记
- ⬜ 待开始
- 🔄 进行中
- ✅ 已完成
- ❌ 已取消
- 🚫 阻塞

---
生成时间：[时间戳]
```

## 工作流程

### 步骤 1：需求分析
```
输入：用户的简单需求描述
执行：
  1. 理解需求的核心目标
  2. 识别关键功能点
  3. 分析技术可行性
  4. 识别潜在风险
输出：需求分析摘要
```

### 步骤 2：生成需求文档
```
执行：
  1. 生成 REQUIREMENTS.md
  2. 包含所有必要章节
  3. 确保描述清晰具体
  4. 验收标准可测试
输出：REQUIREMENTS.md 文件
```

### 步骤 3：任务拆解
```
执行：
  1. 将需求拆解为可执行任务
  2. 任务粒度：2-4 小时可完成
  3. 标记优先级和依赖关系
  4. 分组为不同阶段
输出：TASK_LIST.md 文件
```

### 步骤 4：展示确认
```
展示：
  ┌─────────────────────────────────────┐
  │ 📋 需求文档已生成                    │
  │                                     │
  │ 功能概述：[一句话描述]               │
  │                                     │
  │ 功能模块：                           │
  │  • 前端：[模块列表]                  │
  │  • 后端：[模块列表]                  │
  │  • 数据库：[模块列表]                │
  │                                     │
  │ 任务总数：X 个                       │
  │  • 阶段1：X 个任务                   │
  │  • 阶段2：X 个任务                   │
  │  • 阶段3：X 个任务                   │
  │  • 阶段4：X 个任务                   │
  │                                     │
  │ 预估工作量：[总时间]                 │
  │                                     │
  │ 文档位置：                           │
  │  • REQUIREMENTS.md                  │
  │  • TASK_LIST.md                     │
  └─────────────────────────────────────┘

  请审查文档内容，然后：
  ✅ 说"继续开发"或"开始开发"开始自动化开发
  ✏️  说"修改[章节名]"调整特定部分
  ❓ 说"详细说明[部分]"获取更多信息
  ❌ 说"取消"终止流程
```

### 步骤 5：处理反馈
```
用户输入 → 响应动作

"继续开发" → 保存进度，准备进入开发阶段
"修改功能模块" → 重新生成功能模块部分
"修改任务列表" → 重新拆解任务
"详细说明技术方案" → 展开技术方案章节
"取消" → 删除生成的文件，终止流程
```

## 触发方式

```bash
# 基本触发
"生成需求文档：[需求描述]"
"需求分析：[需求描述]"
"帮我拆解需求：[需求描述]"

# 示例
"生成需求文档：实现用户登录注册功能"
"需求分析：添加购物车和订单管理"
"帮我拆解需求：搭建一个博客系统"
```

## 智能分析能力

### 自动识别项目类型
- Web 应用
- 移动应用
- API 服务
- 桌面应用
- CLI 工具
- 库/SDK

### 自动检测技术栈
通过读取项目文件自动识别：
- `package.json` → Node.js/前端项目
- `requirements.txt` / `pyproject.toml` → Python 项目
- `go.mod` → Go 项目
- `Cargo.toml` → Rust 项目

### 智能建议
- 基于现有代码风格提供技术方案
- 识别项目中已有的模块和模式
- 建议复用现有组件

## 断点续传

### 进度记录
生成文档时创建 `.claude-fulldev.json`：

```json
{
  "feature": "功能名称",
  "phase": "requirements",
  "started_at": "2024-01-01T10:00:00Z",
  "status": "waiting_confirmation",
  "files": {
    "requirements": "REQUIREMENTS.md",
    "tasks": "TASK_LIST.md"
  },
  "user_confirmed": false
}
```

### 恢复流程
会话中断后重连：
```
用户: "继续" / "resume"

AI: 检测到未完成的需求分析...
    功能: [功能名称]
    状态: 等待确认

    [展示文档摘要]

    是否继续审查？
```

## 质量检查

生成文档前自动检查：
- ✅ 验收标准是否可测试
- ✅ 任务是否足够具体（2-4小时粒度）
- ✅ 是否识别了关键风险
- ✅ 技术方案是否匹配现有项目
- ✅ 模块划分是否合理

## 输出示例

### 简短摘要格式
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 需求文档生成完成

功能：用户登录注册系统

模块划分：
  前端：登录表单、注册表单、验证组件
  后端：认证API、用户管理、会话管理
  数据库：用户表、会话表

任务：共 12 个任务，4 个阶段
预估：约 2-3 天

📄 REQUIREMENTS.md
📋 TASK_LIST.md

请审查后输入"继续开发"开始实现
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 最佳实践

### 需求描述建议
```
好的需求描述：
✅ "实现用户登录注册功能，支持邮箱和手机号注册，包含找回密码"
✅ "添加商品评论系统，用户可以评分、评论、上传图片"

不够清晰的描述：
❌ "做个登录"
❌ "加个评论功能"
```

### 文档质量标准
- 每个功能都有明确的验收标准
- 任务粒度合适（2-4 小时）
- 技术方案具体可执行
- 风险识别充分
- 依赖关系清晰

## 配置选项

可在触发时指定：
```
"生成需求文档，详细程度：简单"  # 生成精简版
"生成需求文档，详细程度：详细"  # 生成完整版（默认）
"生成需求文档，跳过技术方案"    # 只做需求和任务拆解
```
